name: Build on push or pull request

on: [ push, pull_request ]

jobs:
  build:

    runs-on: macos-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      - name: Install dependencies
        run: brew install boost
      - name: Configure library
        run: cmake -S . -B build -DCMAKE_BUILD_TYPE=Release -DCMAKE_OSX_DEPLOYMENT_TARGET=10.5 -DCMAKE_OSX_ARCHITECTURES="x86_64;arm64"
      - name: Build library
        run: cmake --build build --config Release -j $(sysctl -n hw.logicalcpu)
      - name: Run tests
        working-directory: build/test
        run: ctest
      - name: Upload artifacts
        uses: actions/upload-artifact@v3
        with:
          name: Examples
          path: build/examples/*.app
